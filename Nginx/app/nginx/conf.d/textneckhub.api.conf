
server {
    listen 80;
    server_name api.textneckhub.o-r.kr textneckhub.o-r.kr; # www ì—†ëŠ” ë„ë©”ì¸ë„ ì¶”ê°€!

    # âœ¨ HTTPë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ HTTPSë¡œ ìë™ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸! âœ¨
    return 301 https://$host$request_uri;

    # Certbot ì¸ì¦ì„ ìœ„í•œ ê²½ë¡œ (ì´ê±´ ê·¸ëŒ€ë¡œ ë‘ê±°ë‚˜ ì¶”ê°€í•´ì¤˜)
    location ~ /.well-known/acme-challenge/ {
        allow all;
        root /var/www/certbot; # Certbot ì›¹ë£¨íŠ¸ ê²½ë¡œ (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œ!)
    }
}

# âœ¨ 443ë²ˆ í¬íŠ¸ (HTTPS) ì„¤ì • ì¶”ê°€! âœ¨
server {
    listen 443 ssl; # 443ë²ˆ í¬íŠ¸ë¡œ HTTPS ìš”ì²­ì„ ë°›ê² ë‹¤!
    server_name api.textneckhub.o-r.kr textneckhub.o-r.kr; # www ì—†ëŠ” ë„ë©”ì¸ë„ ì¶”ê°€!

    # âœ¨ ë°œê¸‰ë°›ì€ ì¸ì¦ì„œ íŒŒì¼ ê²½ë¡œ ì§€ì •! âœ¨
    ssl_certificate /etc/letsencrypt/live/api.textneckhub.o-r.kr/fullchain.pem; # ì „ì²´ ì¸ì¦ì„œ ì²´ì¸ íŒŒì¼
    ssl_certificate_key /etc/letsencrypt/live/api.textneckhub.o-r.kr/privkey.pem; # ê°œì¸ í‚¤ íŒŒì¼

    # âœ¨ SSL ê´€ë ¨ ì¶”ê°€ ì„¤ì • (ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•´ ì¶”ì²œ!) âœ¨
    ssl_protocols TLSv1.2 TLSv1.3; # ìµœì‹  TLS ë²„ì „ ì‚¬ìš©
    ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"; # ì•ˆì „í•œ ì•”í˜¸í™” ë°©ì‹ë§Œ ì‚¬ìš©
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    ssl_session_tickets off;
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 127.0.0.11 valid=30s;
    resolver_timeout 5s;

    # âœ¨ HSTS (HTTP Strict Transport Security) ì„¤ì • (ë³´ì•ˆ ê°•í™”!) âœ¨
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

    # âœ¨ ëª¨ë“  ìš”ì²­ì„ ë°±ì—”ë“œ(auth ì„œë¹„ìŠ¤)ë¡œ í”„ë¡ì‹œ! âœ¨
    location / {
        # ğŸš¨ğŸš¨ğŸš¨ ì´ ë¶€ë¶„ì—ì„œ 'root', 'index', 'try_files'ë¥¼ ì œê±°í–ˆì–´! ğŸš¨ğŸš¨ğŸš¨
        # Nginxê°€ ë°±ì—”ë“œ(auth:8000)ë¡œ ëª¨ë“  ìš”ì²­ì„ í”„ë¡ì‹œí•  ê²½ìš°,
        # ì—¬ê¸°ì„œëŠ” ì •ì  íŒŒì¼ ì„œë¹™ ê´€ë ¨ ì§€ì‹œì–´ëŠ” í•„ìš” ì—†ì–´!
        # ë°±ì—”ë“œ ì„œë¹„ìŠ¤(Django ë“±)ê°€ ì •ì  íŒŒì¼ì„ ì§ì ‘ ì„œë¹™í•˜ê±°ë‚˜,
        # Nginxê°€ ë³„ë„ì˜ location ë¸”ë¡ì—ì„œ ì •ì  íŒŒì¼ì„ ì„œë¹™í•´ì•¼ í•´.
        proxy_pass http://auth:8000; # <-- auth ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë„˜ê²¨ì¤˜!
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

   
    location /static/ {
        alias /app/static/; # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ì •ì  íŒŒì¼ ê²½ë¡œ (volumesì— ë§ˆìš´íŠ¸ë˜ì–´ ìˆì–´ì•¼ í•¨)
        expires 30d; # ìºì‹± ì„¤ì •
        add_header Cache-Control "public, no-transform";
    }

    
    location /media/ {
        alias /app/media/; # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ë¯¸ë””ì–´ íŒŒì¼ ê²½ë¡œ (volumesì— ë§ˆìš´íŠ¸ë˜ì–´ ìˆì–´ì•¼ í•¨)
        expires 30d; # ìºì‹± ì„¤ì •
        add_header Cache-Control "public, no-transform";
    }

    # ë‹¤ë¥¸ location ë¸”ë¡ë“¤ (ì˜ˆ: /api ê²½ë¡œëŠ” ë°±ì—”ë“œë¡œ ë„˜ê¸°ê¸° ë“±)
    # location /api/ {
    #     proxy_pass http://[API ì„œë²„ ì£¼ì†Œ]:[API ì„œë²„ í¬íŠ¸];
    #     # ... ë‹¤ë¥¸ í”„ë¡ì‹œ ì„¤ì •ë“¤ ...
    # }
}

# server {
#     listen 80;
#     server_name api.textneckhub.p-e.kr textneckhub.p-e.kr; # www ì—†ëŠ” ë„ë©”ì¸ë„ ì¶”ê°€!

#     # âœ¨ HTTPë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ HTTPSë¡œ ìë™ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸! âœ¨
#     return 301 https://$host$request_uri;

#     # Certbot ì¸ì¦ì„ ìœ„í•œ ê²½ë¡œ (ì´ê±´ ê·¸ëŒ€ë¡œ ë‘ê±°ë‚˜ ì¶”ê°€í•´ì¤˜)
#     location ~ /.well-known/acme-challenge/ {
#         allow all;
#         root /var/www/certbot; # Certbot ì›¹ë£¨íŠ¸ ê²½ë¡œ (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œ!)
#     }
# }

# # âœ¨ 443ë²ˆ í¬íŠ¸ (HTTPS) ì„¤ì • ì¶”ê°€! âœ¨
# server {
#     listen 443 ssl; # 443ë²ˆ í¬íŠ¸ë¡œ HTTPS ìš”ì²­ì„ ë°›ê² ë‹¤!
#     server_name api.textneckhub.p-e.kr textneckhub.p-e.kr; # www ì—†ëŠ” ë„ë©”ì¸ë„ ì¶”ê°€!

#     # âœ¨ ë°œê¸‰ë°›ì€ ì¸ì¦ì„œ íŒŒì¼ ê²½ë¡œ ì§€ì •! âœ¨
#     ssl_certificate /etc/letsencrypt/live/api.textneckhub.p-e.kr/fullchain.pem; # ì „ì²´ ì¸ì¦ì„œ ì²´ì¸ íŒŒì¼
#     ssl_certificate_key /etc/letsencrypt/live/api.textneckhub.p-e.kr/privkey.pem; # ê°œì¸ í‚¤ íŒŒì¼

#     # âœ¨ SSL ê´€ë ¨ ì¶”ê°€ ì„¤ì • (ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•´ ì¶”ì²œ!) âœ¨
#     ssl_protocols TLSv1.2 TLSv1.3; # ìµœì‹  TLS ë²„ì „ ì‚¬ìš©
#     ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"; # ì•ˆì „í•œ ì•”í˜¸í™” ë°©ì‹ë§Œ ì‚¬ìš©
#     ssl_prefer_server_ciphers off;
#     ssl_session_cache shared:SSL:10m;
#     ssl_session_timeout 10m;
#     ssl_session_tickets off;
#     ssl_stapling on;
#     ssl_stapling_verify on;
#     resolver 127.0.0.11 valid=30s;
#     resolver_timeout 5s;

#     # âœ¨ HSTS (HTTP Strict Transport Security) ì„¤ì • (ë³´ì•ˆ ê°•í™”!) âœ¨
#     add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

#     # âœ¨ ëª¨ë“  ìš”ì²­ì„ ë°±ì—”ë“œ(auth ì„œë¹„ìŠ¤)ë¡œ í”„ë¡ì‹œ! âœ¨
#     location / {
#         # ğŸš¨ğŸš¨ğŸš¨ ì´ ë¶€ë¶„ì—ì„œ 'root', 'index', 'try_files'ë¥¼ ì œê±°í–ˆì–´! ğŸš¨ğŸš¨ğŸš¨
#         # Nginxê°€ ë°±ì—”ë“œ(auth:8000)ë¡œ ëª¨ë“  ìš”ì²­ì„ í”„ë¡ì‹œí•  ê²½ìš°,
#         # ì—¬ê¸°ì„œëŠ” ì •ì  íŒŒì¼ ì„œë¹™ ê´€ë ¨ ì§€ì‹œì–´ëŠ” í•„ìš” ì—†ì–´!
#         # ë°±ì—”ë“œ ì„œë¹„ìŠ¤(Django ë“±)ê°€ ì •ì  íŒŒì¼ì„ ì§ì ‘ ì„œë¹™í•˜ê±°ë‚˜,
#         # Nginxê°€ ë³„ë„ì˜ location ë¸”ë¡ì—ì„œ ì •ì  íŒŒì¼ì„ ì„œë¹™í•´ì•¼ í•´.
#         proxy_pass http://auth:8000; # <-- auth ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë„˜ê²¨ì¤˜!
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

   
#     location /static/ {
#         alias /app/static/; # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ì •ì  íŒŒì¼ ê²½ë¡œ (volumesì— ë§ˆìš´íŠ¸ë˜ì–´ ìˆì–´ì•¼ í•¨)
#         expires 30d; # ìºì‹± ì„¤ì •
#         add_header Cache-Control "public, no-transform";
#     }

    
#     location /media/ {
#         alias /app/media/; # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ë¯¸ë””ì–´ íŒŒì¼ ê²½ë¡œ (volumesì— ë§ˆìš´íŠ¸ë˜ì–´ ìˆì–´ì•¼ í•¨)
#         expires 30d; # ìºì‹± ì„¤ì •
#         add_header Cache-Control "public, no-transform";
#     }

#     # ë‹¤ë¥¸ location ë¸”ë¡ë“¤ (ì˜ˆ: /api ê²½ë¡œëŠ” ë°±ì—”ë“œë¡œ ë„˜ê¸°ê¸° ë“±)
#     # location /api/ {
#     #     proxy_pass http://[API ì„œë²„ ì£¼ì†Œ]:[API ì„œë²„ í¬íŠ¸];
#     #     # ... ë‹¤ë¥¸ í”„ë¡ì‹œ ì„¤ì •ë“¤ ...
#     # }
# }
