# -------------------------------------------------------------------
# HTTP (80ë²ˆ í¬íŠ¸) -> HTTPS (443ë²ˆ í¬íŠ¸) ìžë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì„¤ì •
# Certbot ì¸ì¦ì„ ìœ„í•œ /.well-known/acme-challenge/ ê²½ë¡œëŠ” ì—¬ê¸°ì„œ ì²˜ë¦¬
# -------------------------------------------------------------------
server {
    listen 80;
    server_name api.textneckhub.p-e.kr;

    # Certbot ì¸ì¦ì„ ìœ„í•œ ê²½ë¡œ (Let's Encrypt ì±Œë¦°ì§€ ì‘ë‹µ)
    location ~ /.well-known/acme-challenge/ {
        allow all;
        root /var/www/certbot; # Certbot ì›¹ë£¨íŠ¸ ê²½ë¡œ (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œ)
    }

    # ê·¸ ì™¸ ëª¨ë“  HTTP ìš”ì²­ì€ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    location / {
        return 301 https://$host$request_uri;
    }
}

# -------------------------------------------------------------------
# HTTPS (443ë²ˆ í¬íŠ¸) ì„¤ì • - API Gateway ì—­í• 
# -------------------------------------------------------------------
server {
    listen 443 ssl;
    server_name api.textneckhub.p-e.kr;

    # âœ¨ ë°œê¸‰ë°›ì€ ì¸ì¦ì„œ íŒŒì¼ ê²½ë¡œ ì§€ì • âœ¨
    ssl_certificate /etc/letsencrypt/live/api.textneckhub.p-e.kr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.textneckhub.p-e.kr/privkey.pem;

    # âœ¨ SSL ê´€ë ¨ ì¶”ê°€ ì„¤ì • (ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•´ ì¶”ì²œ!) âœ¨
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384";
    ssl_prefer_server_ciphers off;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    ssl_session_tickets off;
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 127.0.0.11 valid=30s; # Docker ë‚´ë¶€ DNS resolver (í•„ìš” ì‹œ)
    resolver_timeout 5s;

    # âœ¨ HSTS (HTTP Strict Transport Security) ì„¤ì • (ë³´ì•ˆ ê°•í™”!) âœ¨
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

    # -------------------------------------------------------------------
    # ðŸš¨ðŸš¨ðŸš¨ ê³µí†µ ì •ì  íŒŒì¼ ë° ë¯¸ë””ì–´ íŒŒì¼ ì„œë¹™ ðŸš¨ðŸš¨ðŸš¨
    # ëª¨ë“  Django ì„œë¹„ìŠ¤ì˜ ì •ì /ë¯¸ë””ì–´ íŒŒì¼ì€ ì—¬ê¸°ì— í†µí•©ë˜ì–´ ì„œë¹™ë©ë‹ˆë‹¤.
    # -------------------------------------------------------------------
    location /static/ {
        alias /var/www/static/; # Nginx ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ì •ì  íŒŒì¼ ê³µí†µ ê²½ë¡œ
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }

    location /media/ {
        alias /var/www/media/; # Nginx ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ë¯¸ë””ì–´ íŒŒì¼ ê³µí†µ ê²½ë¡œ
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }

    # -------------------------------------------------------------------
    # ðŸš¨ðŸš¨ðŸš¨ ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ API ì—”ë“œí¬ì¸íŠ¸ í”„ë¡ì‹œ ðŸš¨ðŸš¨ðŸš¨
    # í´ë¼ì´ì–¸íŠ¸(í”„ë¡ íŠ¸ì—”ë“œ)ëŠ” ì´ ê²½ë¡œë¡œ API ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.
    # ê° ì„œë¹„ìŠ¤ì˜ urls.pyëŠ” ì´ ì ‘ë‘ì‚¬(/auth/, /board/ ë“±)ë¥¼ ì œì™¸í•œ ê²½ë¡œë¡œ ì‹œìž‘í•´ì•¼ í•©ë‹ˆë‹¤.
    # -------------------------------------------------------------------

    # ì¸ì¦ ì„œë¹„ìŠ¤ (Auth Service) API
    # ì˜ˆì‹œ: api.textneckhub.p-e.kr/auth/v1/login -> auth_service:8000/v1/login
    location /auth/ {
        proxy_pass http://auth:8000/; # <-- ì¸ì¦ ì„œë¹„ìŠ¤ì˜ ê¸°ë³¸ URLë¡œ í”„ë¡ì‹œ (ìŠ¬ëž˜ì‹œ ì¤‘ìš”!)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ê²Œì‹œíŒ ì„œë¹„ìŠ¤ (Board Service) API
    # ì˜ˆì‹œ: api.textneckhub.p-e.kr/board/v1/boards/free/posts -> board_service:8001/v1/boards/free/posts
    # location /board/ {
    #     proxy_pass http://board:8000/; # <-- ê²Œì‹œíŒ ì„œë¹„ìŠ¤ì˜ ê¸°ë³¸ URLë¡œ í”„ë¡ì‹œ
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }

    # ìœ ì € ì„œë¹„ìŠ¤ (User Service) API (ì˜ˆì‹œ)
    # ì˜ˆì‹œ: api.textneckhub.p-e.kr/user/v1/profiles -> user_service:8002/v1/profiles
    # location /user/ {
    #     proxy_pass http://user_service:8002/; # <-- ìœ ì € ì„œë¹„ìŠ¤ì˜ ê¸°ë³¸ URLë¡œ í”„ë¡ì‹œ
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }

    # -------------------------------------------------------------------
    # ðŸš¨ðŸš¨ðŸš¨ ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ ì–´ë“œë¯¼ íŽ˜ì´ì§€ í”„ë¡ì‹œ ðŸš¨ðŸš¨ðŸš¨
    # ê° Django ì„œë¹„ìŠ¤ì˜ urls.pyì— admin ê²½ë¡œê°€ ì •ì˜ë˜ì–´ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.
    # (ì˜ˆ: path('admin/', admin.site.urls) ë˜ëŠ” path('my-admin/', admin.site.urls))
    # -------------------------------------------------------------------

    # ì¸ì¦ ì„œë¹„ìŠ¤ (Auth Service) Admin
    # ì˜ˆì‹œ: api.textneckhub.p-e.kr/auth-admin/ -> auth_service:8000/admin/
    location /auth-admin/ {
        proxy_pass http://auth:8000/admin/; # <-- ì¸ì¦ ì„œë¹„ìŠ¤ì˜ admin ê²½ë¡œë¡œ í”„ë¡ì‹œ
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ê²Œì‹œíŒ ì„œë¹„ìŠ¤ (Board Service) Admin
    # ì˜ˆì‹œ: api.textneckhub.p-e.kr/board-admin/ -> board_service:8001/admin/
    # location /board-admin/ {
    #     proxy_pass http://board_service:8000/admin/; # <-- ê²Œì‹œíŒ ì„œë¹„ìŠ¤ì˜ admin ê²½ë¡œë¡œ í”„ë¡ì‹œ
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }

    # ìœ ì € ì„œë¹„ìŠ¤ (User Service) Admin (ì˜ˆì‹œ)
    # ì˜ˆì‹œ: api.textneckhub.p-e.kr/user-admin/ -> user_service:8002/admin/
    # location /user-admin/ {
    #     proxy_pass http://user_service:8002/admin/; # <-- ìœ ì € ì„œë¹„ìŠ¤ì˜ admin ê²½ë¡œë¡œ í”„ë¡ì‹œ
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #     proxy_set_header X-Forwarded-Proto $scheme;
    # }

    # -------------------------------------------------------------------
    # ðŸš¨ðŸš¨ðŸš¨ ê¸°ë³¸ Catch-all (ëª¨ë“  ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ìš”ì²­) ðŸš¨ðŸš¨ðŸš¨
    # ì´ ë„ë©”ì¸ì´ API ì „ìš©ì´ë¼ë©´, ë§¤ì¹­ë˜ì§€ ì•ŠëŠ” ìš”ì²­ì€ 404ë¥¼ ë°˜í™˜í•˜ê±°ë‚˜
    # ê¸°ë³¸ API ìƒíƒœ íŽ˜ì´ì§€ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
    # -------------------------------------------------------------------
    location / {
        # API ì „ìš© ë„ë©”ì¸ì—ì„œ ë§¤ì¹­ë˜ëŠ” API ê²½ë¡œê°€ ì—†ë‹¤ë©´ 404 ë°˜í™˜
        return 404; 
        # ë˜ëŠ” ê°„ë‹¨í•œ API ìƒíƒœ ë©”ì‹œì§€ ë°˜í™˜
        # return 200 "API Gateway is running.";
    }
}
# server {
#     listen 80;
#     server_name api.textneckhub.p-e.kr; # www ì—†ëŠ” ë„ë©”ì¸ë„ ì¶”ê°€!

#     # âœ¨ HTTPë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì„ HTTPSë¡œ ìžë™ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸! âœ¨
#     return 301 https://$host$request_uri;

#     # Certbot ì¸ì¦ì„ ìœ„í•œ ê²½ë¡œ (ì´ê±´ ê·¸ëŒ€ë¡œ ë‘ê±°ë‚˜ ì¶”ê°€í•´ì¤˜)
#     location ~ /.well-known/acme-challenge/ {
#         allow all;
#         root /var/www/certbot; # Certbot ì›¹ë£¨íŠ¸ ê²½ë¡œ (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œ!)
#     }
# }

# # âœ¨ 443ë²ˆ í¬íŠ¸ (HTTPS) ì„¤ì • ì¶”ê°€! âœ¨
# server {
#     listen 443 ssl; # 443ë²ˆ í¬íŠ¸ë¡œ HTTPS ìš”ì²­ì„ ë°›ê² ë‹¤!
#     server_name api.textneckhub.p-e.kr; # www ì—†ëŠ” ë„ë©”ì¸ë„ ì¶”ê°€!

#     # âœ¨ ë°œê¸‰ë°›ì€ ì¸ì¦ì„œ íŒŒì¼ ê²½ë¡œ ì§€ì •! âœ¨
#     ssl_certificate /etc/letsencrypt/live/api.textneckhub.p-e.kr/fullchain.pem; # ì „ì²´ ì¸ì¦ì„œ ì²´ì¸ íŒŒì¼
#     ssl_certificate_key /etc/letsencrypt/live/api.textneckhub.p-e.kr/privkey.pem; # ê°œì¸ í‚¤ íŒŒì¼

#     # âœ¨ SSL ê´€ë ¨ ì¶”ê°€ ì„¤ì • (ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•´ ì¶”ì²œ!) âœ¨
#     ssl_protocols TLSv1.2 TLSv1.3; # ìµœì‹  TLS ë²„ì „ ì‚¬ìš©
#     ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"; # ì•ˆì „í•œ ì•”í˜¸í™” ë°©ì‹ë§Œ ì‚¬ìš©
#     ssl_prefer_server_ciphers off;
#     ssl_session_cache shared:SSL:10m;
#     ssl_session_timeout 10m;
#     ssl_session_tickets off;
#     ssl_stapling on;
#     ssl_stapling_verify on;
#     resolver 127.0.0.11 valid=30s;
#     resolver_timeout 5s;

#     # âœ¨ HSTS (HTTP Strict Transport Security) ì„¤ì • (ë³´ì•ˆ ê°•í™”!) âœ¨
#     add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

#     # âœ¨ ëª¨ë“  ìš”ì²­ì„ ë°±ì—”ë“œ(auth ì„œë¹„ìŠ¤)ë¡œ í”„ë¡ì‹œ! âœ¨
#     location / {
#         # ðŸš¨ðŸš¨ðŸš¨ ì´ ë¶€ë¶„ì—ì„œ 'root', 'index', 'try_files'ë¥¼ ì œê±°í–ˆì–´! ðŸš¨ðŸš¨ðŸš¨
#         # Nginxê°€ ë°±ì—”ë“œ(auth:8000)ë¡œ ëª¨ë“  ìš”ì²­ì„ í”„ë¡ì‹œí•  ê²½ìš°,
#         # ì—¬ê¸°ì„œëŠ” ì •ì  íŒŒì¼ ì„œë¹™ ê´€ë ¨ ì§€ì‹œì–´ëŠ” í•„ìš” ì—†ì–´!
#         # ë°±ì—”ë“œ ì„œë¹„ìŠ¤(Django ë“±)ê°€ ì •ì  íŒŒì¼ì„ ì§ì ‘ ì„œë¹™í•˜ê±°ë‚˜,
#         # Nginxê°€ ë³„ë„ì˜ location ë¸”ë¡ì—ì„œ ì •ì  íŒŒì¼ì„ ì„œë¹™í•´ì•¼ í•´.
#         proxy_pass http://auth:8000; # <-- auth ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë„˜ê²¨ì¤˜!
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }

   
#     location /static/ {
#         alias /app/static/; # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ì •ì  íŒŒì¼ ê²½ë¡œ (volumesì— ë§ˆìš´íŠ¸ë˜ì–´ ìžˆì–´ì•¼ í•¨)
#         expires 30d; # ìºì‹± ì„¤ì •
#         add_header Cache-Control "public, no-transform";
#     }

    
#     location /media/ {
#         alias /app/media/; # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ë¯¸ë””ì–´ íŒŒì¼ ê²½ë¡œ (volumesì— ë§ˆìš´íŠ¸ë˜ì–´ ìžˆì–´ì•¼ í•¨)
#         expires 30d; # ìºì‹± ì„¤ì •
#         add_header Cache-Control "public, no-transform";
#     }

#     # ë‹¤ë¥¸ location ë¸”ë¡ë“¤ (ì˜ˆ: /api ê²½ë¡œëŠ” ë°±ì—”ë“œë¡œ ë„˜ê¸°ê¸° ë“±)
#     # location /api/ {
#     #     proxy_pass http://[API ì„œë²„ ì£¼ì†Œ]:[API ì„œë²„ í¬íŠ¸];
#     #     # ... ë‹¤ë¥¸ í”„ë¡ì‹œ ì„¤ì •ë“¤ ...
#     # }
# }

# /etc/nginx/nginx.conf ë˜ëŠ” /etc/nginx/conf.d/api-gateway.conf íŒŒì¼ì— ìž‘ì„±
# /etc/nginx/nginx.conf (http ë¸”ë¡ ë‚´ë¶€) ë˜ëŠ” /etc/nginx/conf.d/api-gateway.conf

# http {
#     # ===========================================================================
#     # âœ¨ Nginx ê¸°ë³¸ ì„¤ì • (ì¼ë°˜ì ìœ¼ë¡œ nginx.confì— ì´ë¯¸ ì¡´ìž¬) âœ¨
#     # ===========================================================================
#     include /etc/nginx/mime.types;
#     default_type application/octet-stream;

#     # ë¡œê·¸ í˜•ì‹ ì„¤ì •
#     log_format main '$remote_addr - $remote_user [$time_local] "$request" '
#                     '$status $body_bytes_sent "$http_referer" '
#                     '"$http_user_agent" "$http_x_forwarded_for" '
#                     '$request_time $upstream_response_time $pipe';

#     access_log /var/log/nginx/access.log main;
#     error_log /var/log/nginx/error.log warn;

#     sendfile on;
#     tcp_nopush on;
#     tcp_nodelay on;
#     keepalive_timeout 65;
#     types_hash_max_size 2048;

#     # í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¼ ìˆ˜ ìžˆëŠ” ìµœëŒ€ ìš”ì²­ ë³¸ë¬¸ í¬ê¸°
#     client_max_body_size 100M;

#     # ===========================================================================
#     # âœ¨ Upstream ì •ì˜: ë‚´ë¶€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ì˜ ì£¼ì†Œë¥¼ ì—¬ê¸°ì— ëª…ì‹œ! âœ¨
#     # Docker í™˜ê²½ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì´ë¦„ì´ DNSì²˜ëŸ¼ ë™ìž‘í•©ë‹ˆë‹¤.
#     # ===========================================================================

#     # 1. ì¸ì¦ ì„œë¹„ìŠ¤ (Auth Service)
#     upstream auth_service {
#         server auth:8000; # ì˜ˆ: Docker Compose ì„œë¹„ìŠ¤ ì´ë¦„ (auth)ê³¼ í¬íŠ¸ (8000)
#     }

#     # 2. ê²Œì‹œíŒ ì„œë¹„ìŠ¤ (Board Service) - ì˜ˆì‹œ
#     upstream board_service {
#         server board:8001; # ì˜ˆ: Docker Compose ì„œë¹„ìŠ¤ ì´ë¦„ (board)ê³¼ í¬íŠ¸ (8001)
#     }

#     # 3. ê¸°íƒ€ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë“¤ë„ ì—¬ê¸°ì— ì¶”ê°€...
#     # upstream another_service {
#     #     server another:8002;
#     # }

#     # ===========================================================================
#     # âœ¨ Server ë¸”ë¡ 1: HTTP (80ë²ˆ í¬íŠ¸) ìš”ì²­ ì²˜ë¦¬ ë° HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸ âœ¨
#     # ===========================================================================
#     server {
#         listen 80; # HTTP ìš”ì²­ì„ ë°›ìŒ
#         server_name api.textneckhub.p-e.kr; # API ë„ë©”ì¸

#         # ëª¨ë“  HTTP ìš”ì²­ì„ HTTPSë¡œ ê°•ì œ ë¦¬ë‹¤ì´ë ‰íŠ¸
#         location / {
#             return 301 https://$host$request_uri;
#         }

#         # Certbot ì¸ì¦ì„ ìœ„í•œ ê²½ë¡œ (Let's Encryptë¥¼ ì‚¬ìš©í•œë‹¤ë©´ í•„ìˆ˜)
#         location ~ /.well-known/acme-challenge/ {
#             allow all;
#             root /var/www/certbot; # Certbot ì›¹ë£¨íŠ¸ ê²½ë¡œ (ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ê²½ë¡œ)
#         }
#     }

#     # ===========================================================================
#     # âœ¨ Server ë¸”ë¡ 2: HTTPS (443ë²ˆ í¬íŠ¸) ìš”ì²­ ì²˜ë¦¬ - API Gatewayì˜ í•µì‹¬ âœ¨
#     # ===========================================================================
#     server {
#         listen 443 ssl http2; # 443ë²ˆ í¬íŠ¸ë¡œ HTTPS ìš”ì²­ì„ ë°›ìŒ
#         server_name api.textneckhub.p-e.kr; # API ë„ë©”ì¸

#         # âœ¨ SSL ì¸ì¦ì„œ íŒŒì¼ ê²½ë¡œ ì§€ì • âœ¨
#         ssl_certificate /etc/letsencrypt/live/api.textneckhub.p-e.kr/fullchain.pem; # ì „ì²´ ì¸ì¦ì„œ ì²´ì¸ íŒŒì¼
#         ssl_certificate_key /etc/letsencrypt/live/api.textneckhub.p-e.kr/privkey.pem; # ê°œì¸ í‚¤ íŒŒì¼

#         # âœ¨ SSL/TLS ë³´ì•ˆ ê°•í™” ì„¤ì • âœ¨
#         ssl_protocols TLSv1.2 TLSv1.3; # ìµœì‹  TLS ë²„ì „ ì‚¬ìš©
#         ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"; # ì•ˆì „í•œ ì•”í˜¸í™” ë°©ì‹ë§Œ ì‚¬ìš©
#         ssl_prefer_server_ciphers off;
#         ssl_session_cache shared:SSL:10m;
#         ssl_session_timeout 10m;
#         ssl_session_tickets off; # ì„¸ì…˜ í‹°ì¼“ ë¹„í™œì„±í™” (ë³´ì•ˆ ê°•í™”)
#         ssl_stapling on; # OCSP ìŠ¤í…Œì´í”Œë§ í™œì„±í™” (ì„±ëŠ¥ ë° ë³´ì•ˆ)
#         ssl_stapling_verify on; # OCSP ìŠ¤í…Œì´í”Œë§ ê²€ì¦
#         resolver 127.0.0.11 valid=30s; # Docker ë‚´ë¶€ DNS (ì»¨í…Œì´ë„ˆ ê°„ í†µì‹  ì‹œ ì¤‘ìš”)
#         resolver_timeout 5s;

#         # âœ¨ HSTS (HTTP Strict Transport Security) ì„¤ì • (ë³´ì•ˆ ê°•í™”) âœ¨
#         add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

#         # ===========================================================================
#         # âœ¨ 1. ì¸ì¦ ì„œë¸Œ ìš”ì²­ (auth_request ëª¨ë“ˆ ì‚¬ìš©) âœ¨
#         # ì´ locationì€ ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ê³ , auth_request ì§€ì‹œì–´ì— ì˜í•´ì„œë§Œ í˜¸ì¶œë©ë‹ˆë‹¤.
#         # ===========================================================================
#         location @auth {
#             internal; # ì™¸ë¶€ ì ‘ê·¼ ê¸ˆì§€
#             # ì¸ì¦ ì„œë¹„ìŠ¤ì˜ í† í° ê²€ì¦ ì—”ë“œí¬ì¸íŠ¸. ì‹¤ì œ í† í° ê²€ì¦ ë¡œì§ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
#             proxy_pass http://auth_service/v2/auth/verify-token/; 
#             proxy_pass_request_body off; # ì¸ì¦ ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ ë³¸ë¬¸ì€ ë³´ë‚´ì§€ ì•ŠìŒ (GET ìš”ì²­ì²˜ëŸ¼)
#             proxy_set_header Content-Length ""; # Content-Length í—¤ë” ì´ˆê¸°í™”

#             # ì›ë³¸ ìš”ì²­ì˜ Authorization í—¤ë”ë¥¼ ì¸ì¦ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬
#             proxy_set_header Authorization $http_authorization;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header Host $host;

#             # ì¸ì¦ ì„œë¹„ìŠ¤ì—ì„œ ê²€ì¦ í›„ ë°˜í™˜í•˜ëŠ” ì‚¬ìš©ìž ì •ë³´ í—¤ë”ë¥¼ Nginx ë³€ìˆ˜ì— ì €ìž¥
#             # (ì¸ì¦ ì„œë¹„ìŠ¤ê°€ ê²€ì¦ ì„±ê³µ ì‹œ X-User-ID, X-User-Roles ë“±ì˜ í—¤ë”ë¥¼ ì‘ë‹µì— í¬í•¨í•´ì•¼ í•¨)
#             auth_request_set $user_id $upstream_http_x_user_id;
#             auth_request_set $user_roles $upstream_http_x_user_roles;
#             auth_request_set $user_email $upstream_http_x_user_email; # ì¶”ê°€ ì •ë³´ ì˜ˆì‹œ
#         }

#         # ===========================================================================
#         # âœ¨ 2. íŠ¹ì • API ê²½ë¡œ ì˜ˆì™¸ ì²˜ë¦¬ (ì¸ì¦ ê²€ì¦ì„ ìš°íšŒ) âœ¨
#         # í† í° ë°œí–‰, ê°±ì‹  ë“± ì•„ì§ í† í°ì´ ì—†ê±°ë‚˜ ê²€ì¦ì´ ë¶ˆí•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ëŠ”
#         # auth_requestë¥¼ ê±°ì¹˜ì§€ ì•Šë„ë¡ ì´ ë¸”ë¡ë“¤ì´ ì¼ë°˜ /v2/ ë¸”ë¡ë³´ë‹¤ ë¨¼ì € ì™€ì•¼ í•©ë‹ˆë‹¤.
#         # ===========================================================================

#         # ì†Œì…œ ë¡œê·¸ì¸ ì½œë°± (ì•¡ì„¸ìŠ¤ í† í° ë°œí–‰) ì—”ë“œí¬ì¸íŠ¸
#         location /v2/auth/access-token/ {
#             proxy_pass http://auth_service/v2/auth/access-token/;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#             # ì—¬ê¸°ì„œëŠ” auth_requestë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
#         }

#         # ë¦¬í”„ë ˆì‹œ í† í° ê°±ì‹  ì—”ë“œí¬ì¸íŠ¸ (simple_jwtì˜ token/refresh)
#         location /v2/auth/token/refresh/ {
#             proxy_pass http://auth_service/v2/auth/token/refresh/;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#             # ì—¬ê¸°ë„ auth_requestë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
#         }

#         # ë¦¬í”„ë ˆì‹œ í† í° ë¬´íš¨í™” ì—”ë“œí¬ì¸íŠ¸ (ë¡œê·¸ì•„ì›ƒ)
#         # ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” ë°±ì—”ë“œì—ì„œ ì¸ì¦ì´ í•„ìš”í•  ìˆ˜ ìžˆì§€ë§Œ, Nginxì—ì„œëŠ” í† í° ë°œí–‰/ê°±ì‹ ê³¼ í•¨ê»˜ ì˜ˆì™¸ ì²˜ë¦¬í•©ë‹ˆë‹¤.
#         location /v2/auth/refresh-token/revoke/ {
#             proxy_pass http://auth_service/v2/auth/refresh-token/revoke/;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#             # ì—¬ê¸°ë„ auth_requestë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
#         }

#         # ===========================================================================
#         # âœ¨ 3. API Gateway ë¼ìš°íŒ… ë° ì¸ì¦/ì¸ê°€ ì²˜ë¦¬ (ì¼ë°˜ì ì¸ API ìš”ì²­) âœ¨
#         # ìœ„ì— ì •ì˜ëœ ì˜ˆì™¸ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì œì™¸í•œ ëª¨ë“  /v2/ ìš”ì²­ì— ì ìš©ë©ë‹ˆë‹¤.
#         # ===========================================================================
#         location /v2/ {
#             auth_request @auth; # ì—¬ê¸°ì—ì„œë§Œ ì¸ì¦ ê²€ì¦ì„ ìˆ˜í–‰!

#             # ì¸ì¦ ì„œë¹„ìŠ¤ì—ì„œ ë°›ì€ ì‚¬ìš©ìž ì •ë³´ë¥¼ ì‹¤ì œ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬
#             proxy_set_header X-User-ID $user_id;
#             proxy_set_header X-User-Roles $user_roles;
#             proxy_set_header X-User-Email $user_email;

#             # ì›ë³¸ í´ë¼ì´ì–¸íŠ¸ ì •ë³´ ì „ë‹¬ (ìµœì¢… ì„œë¹„ìŠ¤ì— ì „ë‹¬)
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header Host $host;
#             proxy_set_header X-Forwarded-Proto $scheme;

#             # ê²½ë¡œì— ë”°ë¼ ì ì ˆí•œ Upstream ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ ì „ë‹¬ (ë¼ìš°íŒ…)
#             # /v2/auth/ ë¡œ ì‹œìž‘í•˜ëŠ” ìš”ì²­ì€ auth_serviceë¡œ
#             rewrite ^/v2/auth/(.*)$ /$1 break;
#             proxy_pass http://auth_service;

#             # /v2/board/ ë¡œ ì‹œìž‘í•˜ëŠ” ìš”ì²­ì€ board_serviceë¡œ
#             rewrite ^/v2/board/(.*)$ /$1 break;
#             proxy_pass http://board_service;

#             # ... ë‹¤ë¥¸ API ê²½ë¡œë“¤ë„ ì—¬ê¸°ì— ì¶”ê°€ ...
#             # rewrite ^/v2/another/(.*)$ /$1 break;
#             # proxy_pass http://another_service;

#             # ë§¤ì¹­ë˜ëŠ” ê·œì¹™ì´ ì—†ìœ¼ë©´ 404 ë°˜í™˜
#             return 404;
#         }

#         # ===========================================================================
#         # âœ¨ 4. Django ì •ì /ë¯¸ë””ì–´ íŒŒì¼ ì„œë¹™ (ì„ íƒ ì‚¬í•­) âœ¨
#         # ì´ Nginxê°€ ì§ì ‘ ì„œë¹™í•˜ëŠ” ê²½ìš°ì—ë§Œ í•„ìš”í•©ë‹ˆë‹¤.
#         # ë³´í†µì€ í”„ë¡ íŠ¸ì—”ë“œ Nginxê°€ ì •ì  íŒŒì¼ì„ ì²˜ë¦¬í•˜ê±°ë‚˜, CDNì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
#         # ===========================================================================
#         location /static/ {
#             alias /app/static/; # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ì •ì  íŒŒì¼ ê²½ë¡œ (volumesì— ë§ˆìš´íŠ¸ë˜ì–´ ìžˆì–´ì•¼ í•¨)
#             expires 30d; # ìºì‹± ì„¤ì •
#             add_header Cache-Control "public, no-transform";
#         }

#         location /media/ {
#             alias /app/media/; # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ ë¯¸ë””ì–´ íŒŒì¼ ê²½ë¡œ (volumesì— ë§ˆìš´íŠ¸ë˜ì–´ ìžˆì–´ì•¼ í•¨)
#             expires 30d; # ìºì‹± ì„¤ì •
#             add_header Cache-Control "public, no-transform";
#         }

#         # ===========================================================================
#         # âœ¨ 5. CORS (Cross-Origin Resource Sharing) ì„¤ì • âœ¨
#         # í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ë„ë©”ì¸ì´ ë‹¤ë¥¼ ê²½ìš° í•„ìˆ˜ìž…ë‹ˆë‹¤.
#         # ===========================================================================
#         # OPTIONS ìš”ì²­ ì²˜ë¦¬ (Preflight Request)
#         location ~ ^/v2/(.*)$ { # /v2/ ê²½ë¡œì— ëŒ€í•œ CORS ì„¤ì •
#             if ($request_method = 'OPTIONS') {
#                 # ë„¤ í”„ë¡ íŠ¸ì—”ë“œ ë„ë©”ì¸ì„ ì •í™•ížˆ ìž…ë ¥í•´ì£¼ì„¸ìš”.
#                 add_header 'Access-Control-Allow-Origin' 'https://www.textneckhub.p-e.kr';
#                 add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, DELETE, PUT, PATCH';
#                 add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-CSRFToken';
#                 add_header 'Access-Control-Allow-Credentials' 'true'; # withCredentials ì‚¬ìš© ì‹œ í•„ìˆ˜
#                 add_header 'Access-Control-Max-Age' 1728000; # Preflight ìºì‹± ì‹œê°„ (20ì¼)
#                 add_header 'Content-Type' 'text/plain; charset=utf-8';
#                 add_header 'Content-Length' 0;
#                 return 204;
#             }

#             # ì‹¤ì œ ìš”ì²­ì— ëŒ€í•œ CORS í—¤ë”
#             # ë„¤ í”„ë¡ íŠ¸ì—”ë“œ ë„ë©”ì¸ì„ ì •í™•ížˆ ìž…ë ¥í•´ì£¼ì„¸ìš”.
#             add_header 'Access-Control-Allow-Origin' 'https://www.textneckhub.p-e.kr';
#             add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, DELETE, PUT, PATCH';
#             add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-CSRFToken';
#             add_header 'Access-Control-Allow-Credentials' 'true'; # withCredentials ì‚¬ìš© ì‹œ í•„ìˆ˜
#             add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
#             # proxy_passëŠ” ìœ„ location /v2/ ì— ì´ë¯¸ ì„¤ì •ë˜ì–´ ìžˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°
#         }
#     }
# }